<!-- <app-page-title [Title]="'POS (Admin)'" [pageTitle]="'POS'"></app-page-title> -->

<div class="grid grid-cols-12 gap-5" x-data="posSystem">
    <div class="col-span-9">
        <div class="flex items-center gap-3 mb-1">
            <h6>Categories</h6>
        </div>
        <div class="swiper mySwiper group/swiper">
            <div class="swiper-wrapper py-4" id="category-wrapper">
                <div class="swiper-slide" *ngFor="let category of categories" [attr.data-category]="category.id"
                    (click)="selectCategory(category.id)">
                    <div class="bg-green-500/10 p-5 border border-green-500/20 rounded-md text-center shadow-lg shadow-gray-100 dark:shadow-dark-850 cursor-pointer"
                        [ngClass]="{ 'active': currentCategory === category.id }">
                        <img [src]="category.icon" [alt]="category.name"
                            class="size-10 mx-auto outline outline-dashed outline-green-500/50 outline-offset-4 rounded-full">
                        <h6 class="mt-4">{{ category.name }}</h6>
                        <p class="text-gray-500 dark:text-dark-500 text-13 mt-1">Items {{ category.itemCount }}</p>
                    </div>
                </div>
            </div>
            <div
                class="swiper-button-next after:!font-remix after:!text-2xl after:text-primary-500 !size-6 bg-white rounded-full opacity-0 group-hover/swiper:opacity-100 transition ease-linear duration-300 after:!content-['\ea6e']">
            </div>
            <div
                class="swiper-button-prev after:!font-remix after:!text-2xl after:text-primary-500 !size-6 bg-white rounded-full opacity-0 group-hover/swiper:opacity-100 transition ease-linear duration-300 after:!content-['\ea64']">
            </div>
        </div>

        <h6 class="mb-3">Select Menu</h6>
        <div class="grid grid-cols-3 gap-x-5">
            <div class="card relative" *ngFor="let product of filteredProducts"
                [attr.data-product-category]="product.category">
                <div class="card-body p-3">
                    <div *ngIf="product.available === 0"
                        class="absolute left-0 top-3 flex items-center justify-center bg-red-500 text-white px-3 py-1 text-13 rounded-r-md z-10 text-sm font-medium">
                        <span>Out of Stock</span>
                    </div>

                    <div class="flex gap-5">
                        <div class="bg-gray-100 shrink-0 rounded-md dark:bg-dark-850 relative">
                            <img [src]="product.image" [alt]="product.name" class="h-28 shrink-0">
                        </div>
                        <div class="grow flex flex-col">
                            <h6 class="mb-2 line-clamp-2 capitalize">{{ product.name }}</h6>
                            <div class="flex gap-2 items-center mb-auto">
                                <p class="text-gray-500 dark:text-dark-500 text-13">{{ product.available }} Available
                                </p>
                                <p class="text-gray-500 dark:text-dark-500 text-13">{{ product.sold }} Sold</p>
                            </div>
                            <!-- Display dynamic price based on quantity -->
                            <h5>${{ getTotalPrice(product) | number:'1.2-2' }}</h5>
                            <p class="text-gray-500 dark:text-dark-500 text-13"
                                *ngIf="getCurrentQuantity(product.id) > 1">
                                (${{ product.price | number:'1.2-2' }} each)
                            </p>
                        </div>
                    </div>

                    <!-- Options (Quantity, Size, Sugar) -->
                    <div *ngIf="product.available > 0">
                        <!-- Size Selector -->
                        <div *ngIf="product.hasSize" class="mt-4">
                            <p class="text-gray-500 dark:text-dark-500 text-14">Size</p>
                            <div class="flex items-center gap-3 mt-3">
                                <button *ngFor="let size of ['s', 'm', 'l']"
                                    (click)="setOption(product.id, 'size', size)"
                                    [ngClass]="isSizeSelected(product.id, size) ? activeSizeClass : sizeClass">
                                    {{ size.toUpperCase() }}
                                </button>
                            </div>
                        </div>

                        <!-- Sugar Selector -->
                        <div *ngIf="product.hasSugarLevel" class="mt-4">
                            <p class="text-gray-500 dark:text-dark-500 text-14">Sugar Level</p>
                            <div class="flex gap-3 mt-3">
                                <button *ngFor="let sugar of ['low', 'medium', 'high']"
                                    (click)="setOption(product.id, 'sugarLevel', sugar)"
                                    [ngClass]="isSugarSelected(product.id, sugar) ? activeSugarClass : sugarClass"
                                    class="cursor-pointer">
                                    {{ sugar[0] | uppercase }}
                                </button>
                            </div>
                        </div>

                        <!-- Quantity and Add Button -->
                        <div class="mt-5">
                            <p class="text-gray-500 dark:text-dark-500 text-14">Quantity</p>
                            <div
                                class="flex items-center w-32 p-1 border border-gray-200 rounded-md dark:border-dark-800 mt-2">
                                <button (click)="changeQty(product.id, -1)"
                                    class="flex items-center justify-center transition duration-200 ease-linear rounded-md text-primary-500 plus size-8 shrink-0 bg-primary-500/20 hover:text-primary-700">
                                    <lucide-angular name="minus" class="size-4"></lucide-angular>
                                </button>
                                <input type="text" class="h-8 text-center w-full border-0"
                                    [value]="getCurrentQuantity(product.id)" readonly>
                                <button (click)="changeQty(product.id, 1)"
                                    class="flex items-center justify-center transition duration-200 ease-linear rounded-md text-primary-500 plus size-8 shrink-0 bg-primary-500/20 hover:text-primary-700">
                                    <lucide-angular name="plus" class="size-4"></lucide-angular>
                                </button>
                            </div>
                            <button type="button" (click)="addToCart(product)" class="btn btn-sub-red w-full mt-4">
                                Add To Cart - ${{ getTotalPrice(product) | number:'1.2-2' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-span-3">
        <app-order-detail [cartItems]="cartItems" [openTab]="1"></app-order-detail>
    </div>
</div>