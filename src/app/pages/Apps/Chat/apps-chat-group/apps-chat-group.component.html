<app-page-title [Title]="'Group Chat'" [pageTitle]="'Chats'"></app-page-title>

<div class="grid grid-cols-12 gap-x-space">
  <div class="col-span-12 2xl:col-span-3 card">
    <div class="card-body">
      <button type="button" title="create group btn" data-modal-target="createGroupModal" (click)="openCreateFolderModal()" class="w-full btn btn-primary">Create New Group</button>
      <div class="relative my-4 group/form">
        <input type="text" class="ltr:pl-9 rtl:pr-9 form-input ltr:group-[&.right]/form:pr-9 rtl:group-[&.right]/form:pl-9 ltr:group-[&.right]/form:pl-4 rtl:group-[&.right]/form:pr-4" placeholder="Search for ..." [(ngModel)]="searchTerms" (ngModelChange)="onSearchTermChange()">
        <button title="search btn" class="absolute inset-y-0 flex items-center text-gray-500 dark:text-dark-500 ltr:left-3 rtl:right-3 ltr:group-[&.right]/form:right-3 rtl:group-[&.right]/form:left-3 ltr:group-[&.right]/form:left-auto rtl:group-[&.right]/form:right-auto focus:outline-hidden">
          <lucide-angular name="search" class="size-4"></lucide-angular>

        </button>
      </div>
      <ngx-simplebar class="max-h-[calc(100vh_-_22.5rem)] -mx-space" [options]="options">
        <ul class="flex flex-col gap-3">
          <ng-container *ngIf="filteredGroups.length > 0">
            <ng-container *ngFor="let group of filteredGroups; let index = index">
              <li>
                <a href="javascript:void(0);" class="flex items-center gap-2 px-space py-2.5 hover:bg-gray-50 dark:hover:bg-dark-850 transition ease-linear duration-300 group/item unread" [ngClass]="{'active': isActiveChat(index)}" (click)="selectGroup(group)">
                  <div class="relative flex items-center justify-center p-2 font-semibold transition duration-200 ease-linear bg-green-500/10 [&.active]:bg-white dark:[&.active]:bg-dark-900 rounded-full size-11 shrink-0 group-[&.unread]/item:bg-white dark:group-[&.unread]/item:bg-dark-900">
                    <img [src]="group.image" alt="" class="rounded-full">
                  </div>
                  <div class="overflow-hidden grow">
                    <h6 class="mb-0.5 truncate">{{group.name}}</h6>
                    <p class="text-sm group-[&.unread]/item:font-medium truncate group-[&.unread]/item:text-gray-950 dark:group-[&.unread]/item:text-dark-50 text-gray-500 dark:text-dark-500 unread">
                      {{group.message}}</p>
                  </div>
                  <div class="ltr:text-right rtl:text-left shrink-0">
                    <p class="mb-1 text-xs text-gray-500 dark:text-dark-500">{{group.time}}</p>
                    <ng-container *ngIf="group.badge">
                      <span class="badge-sub-red badge-square size-5">{{group.badge}}</span>
                    </ng-container>
                  </div>
                </a>
              </li>
            </ng-container>
          </ng-container>
          <ng-container *ngIf="filteredGroups.length == 0">
            <li>
              <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" class="mx-auto size-12" viewBox="0 0 48 48">
                <linearGradient id="SVGID_1__h35ynqzIJzH4_gr1" x1="34.598" x2="15.982" y1="15.982" y2="34.598" gradientUnits="userSpaceOnUse">
                  <stop offset="0" stop-color="#60e8fe"></stop>
                  <stop offset=".033" stop-color="#6ae9fe"></stop>
                  <stop offset=".197" stop-color="#97f0fe"></stop>
                  <stop offset=".362" stop-color="#bdf5ff"></stop>
                  <stop offset=".525" stop-color="#dafaff"></stop>
                  <stop offset=".687" stop-color="#eefdff"></stop>
                  <stop offset=".846" stop-color="#fbfeff"></stop>
                  <stop offset="1" stop-color="#fff"></stop>
                </linearGradient>
                <path fill="url(#SVGID_1__h35ynqzIJzH4_gr1)" d="M40.036,33.826L31.68,25.6c0.847-1.739,1.335-3.684,1.335-5.748c0-7.27-5.894-13.164-13.164-13.164	S6.688,12.582,6.688,19.852c0,7.27,5.894,13.164,13.164,13.164c2.056,0,3.995-0.485,5.728-1.326l3.914,4.015l4.331,4.331	c1.715,1.715,4.496,1.715,6.211,0C41.751,38.321,41.751,35.541,40.036,33.826z">
                </path>
                <path fill="none" stroke="#10cfe3" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" d="M31.95,25.739l8.086,8.086c1.715,1.715,1.715,4.496,0,6.211l0,0c-1.715,1.715-4.496,1.715-6.211,0	l-4.331-4.331">
                </path>
                <path fill="none" stroke="#10cfe3" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" d="M7.525,24.511c-1.771-4.694-0.767-10.196,3.011-13.975c3.847-3.847,9.48-4.817,14.228-2.912"></path>
                <path fill="none" stroke="#10cfe3" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3" d="M30.856,12.603c3.376,5.114,2.814,12.063-1.688,16.565c-4.858,4.858-12.565,5.129-17.741,0.814">
                </path>
              </svg>
              <p class="mt-2 text-center text-gray-500 dark:text-dark-500">No matching records found</p>
            </li>
          </ng-container>
        </ul>
      </ngx-simplebar>
    </div>
  </div>
  <div class="col-span-12 overflow-hidden 2xl:col-span-6 card">
    <ngx-simplebar class="max-h-[calc(100vh_-_19rem)] min-h-[calc(100vh_-_19rem)] relative" [options]="options">
      <div class="sticky inset-x-0 top-0 z-50 flex items-center gap-3 border-b border-gray-200 card-body bg-white/30 dark:bg-dark-900/60 dark:border-dark-800 backdrop-blur-lg">
        <div class="xl:hidden shrink-0">
          <button class="btn btn-sub-gray btn-icon">
            <lucide-angular name="ChevronLeft" class="size-5"></lucide-angular>
          </button>
        </div>
        <div *ngIf="selectedGroup" class="relative flex items-center justify-center p-2 font-semibold transition duration-200 ease-linear bg-gray-100 rounded-full dark:bg-dark-850 size-11 shrink-0">
          <img [src]="selectedGroup.image" alt="" class="rounded-full">
        </div>
        <div class="grow">
          <h6><a href="javascript:void(0);">{{selectedGroup?.name}}</a></h6>
          <p class="text-gray-500 dark:text-dark-500">Active</p>
        </div>
        <button title="phone call btn" class="btn btn-active-gray btn-icon shrink-0" (click)="openCallModal()">
          <lucide-angular name="phone" class="size-5"></lucide-angular>
        </button>
        <button title="video call btn" class="btn btn-active-gray btn-icon shrink-0" (click)="openVideoCallModal()">
          <lucide-angular name="video" class="size-5"></lucide-angular>
        </button>
      </div>
      <div class="pb-0 card-body">
        <div class="flex flex-col justify-end min-h-[calc(100vh_-_24rem)] gap-5" id="groupchat-messages">
          <ng-container *ngFor="let message of allMessage; let index = index">
            <div class="flex items-end max-w-xl gap-3 ltr:[&.right]:ml-auto rtl:[&.right]:mr-auto group/chat" [ngClass]="{'right': message.type === 'sent'}">
              <div class="relative flex items-center justify-center font-semibold transition duration-200 ease-linear bg-gray-100 dark:bg-dark-850 rounded-full size-8 shrink-0 group-[&.right]/chat:order-2">
                <img [src]="message.user.avatar" alt="" class="rounded-full">
                <span class="absolute bottom-0 bg-green-500 border-2 border-white dark:border-dark-900 rounded-full ltr:right-0 rtl:left-0 size-2.5"></span>
              </div>
              <div class="grow *:mb-3">
                <div class="flex items-end gap-2 last:mb-0">
                  <div class="grow">
                    <p class="ltr:group-[&.right]/chat:text-right rtl:group-[&.right]/chat:text-left text-gray-500 dark:text-dark-500 mb-1 text-xs">
                      {{message.timestamp}}</p>
                    <div class="px-4 py-2.5 last:mb-0 bg-gray-100 rounded-xl dark:bg-dark-850 ltr:rounded-bl-none rtl:rounded-br-none group-[&.right]/chat:order-1 ltr:group-[&.right]/chat:rounded-bl-lg rtl:group-[&.right]/chat:rounded-br-lg ltr:group-[&.right]/chat:rounded-br-none rtl:group-[&.right]/chat:rounded-bl-none">
                      {{message.message}}
                    </div>
                  </div>
                  <div class="dropdown">
                    <button title="dropdown btn" domixDropdownToggle [dropdownMenu]="dropdown1" type="button" class="flex items-center text-gray-500">
                      <i class="ri-more-2-fill"></i>
                    </button>
                    <div #dropdown1 class="!fixed p-2 dropdown-menu" dropdown-position="right">
                      <ul>
                        <li>
                          <a href="javascript: void(0);" class="flex items-center px-4 py-1.5 text-gray-500 hover:text-primary-500 text-14 transition duration-300 ease-linear">
                            <i class="align-middle ltr:mr-2 rtl:ml-2 ri-reply-line"></i> <span>Reply</span>
                          </a>
                        </li>
                        <li>
                          <a href="javascript: void(0);" class="flex items-center px-4 py-1.5 text-gray-500 hover:text-red-500 text-14 transition duration-300 ease-linear" (click)="deleteModal(index)">
                            <i class="align-middle ltr:mr-2 rtl:ml-2 ri-delete-bin-line"></i> <span>Delete</span>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </ngx-simplebar>
    <div class="card-body">
      <div class="flex items-center gap-2 p-2 border border-gray-200 rounded-md dark:border-dark-800">
        <button title="voice audio" class="btn btn-active-gray btn-icon shrink-0">
          <lucide-angular name="audio-lines" class="size-5"></lucide-angular>
        </button>
        <input type="text" class="border-0 form-input grow" placeholder="Type something ..." [(ngModel)]="message" (keydown.enter)="sendMessage()">
        <button title="submit" (click)="sendMessage()" class="btn btn-active-primary btn-icon shrink-0">
          <lucide-angular name="Send" class="size-5"></lucide-angular>
        </button>
        <div class="shrink-0">
          <label for="sendImages" class="btn btn-active-gray btn-icon">
            <lucide-angular name="image" class="size-5"></lucide-angular>
          </label>
          <input title="Images upload" type="file" id="sendImages" class="hidden">
        </div>
        <button title="emoji" class="text-lg btn btn-active-gray btn-icon shrink-0">
          😊
        </button>
        <div class="dropdown">
          <button title="dropdown btn" domixDropdownToggle [dropdownMenu]="dropdown2" type="button" class="text-lg btn btn-active-gray btn-icon shrink-0">
            <lucide-angular name="ellipsis" class="size-5"></lucide-angular>
          </button>
          <div #dropdown2 class="!fixed p-2 dropdown-menu">
            <ul>
              <li>
                <a href="javascript: void(0);" class="dropdown-item" (click)="clearChat()">
                  <i class="align-middle ltr:mr-2 rtl:ml-2 ri-chat-4-line"></i> <span>Clear Chat</span>
                </a>
              </li>
              <li>
                <a href="javascript: void(0);" data-modal-target="deleteModal" class="dropdown-item">
                  <i class="align-middle ltr:mr-2 rtl:ml-2 ri-delete-bin-line"></i> <span>Delete</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-span-12 2xl:col-span-3 card">
    <div class="card-body">
      <div class="text-center">
        <div *ngIf="selectedGroup" class="relative flex items-center justify-center p-4 font-semibold transition duration-200 ease-linear bg-green-500/10 rounded-full size-24 mx-auto shrink-0 group-[&.unread]/item:bg-white dark:group-[&.unread]/item:bg-dark-900">
          <img [src]="selectedGroup.image" alt="" class="rounded-full">
        </div>
        <h6 class="mt-3">{{selectedGroup?.name}}</h6>
        <p class="text-gray-500 dark:text-dark-500">Create by admin</p>
      </div>
      <div>
        <div class="flex items-center mt-5 mb-3">
          <h6 class="grow">Member (<span>{{allMembers.length}}</span>)</h6>
          <a href="javascript: void(0);" class="link link-primary">
            <lucide-angular name="plus" class="inline-block size-4"></lucide-angular> Add
          </a>
        </div>

        <ngx-simplebar class="px-5 -mx-5 max-h-72" [options]="options">
          <div class="flex flex-col gap-4">
            <ng-container *ngFor="let member of allMembers">
              <a href="javascript: void(0);" class="flex items-center gap-2">
                <div class="flex items-center justify-center font-semibold transition duration-200 ease-linear bg-gray-100 rounded-full dark:bg-dark-850 shrink-0 size-6">
                  <img [src]="member.avatar" alt="" class="rounded-full">
                </div>
                <h6 class="grow">{{member.name}}</h6>
                <p class="text-gray-500 dark:text-dark-500">{{member.role}}</p>
              </a>
            </ng-container>
          </div>
        </ngx-simplebar>

        <div class="mt-5">
          <h6 class="mb-2">Attachments</h6>
          <ngx-simplebar class="px-5 -mx-5 max-h-36" [options]="options">
            <div class="flex flex-col gap-3">
              <a href="javascript: void(0);" class="flex items-center gap-2 p-2 transition duration-300 ease-linear border border-gray-200 border-dashed rounded-md dark:border-dark-800 hover:border-gray-300 dark:hover:border-dark-700 hover:shadow-lg hover:shadow-gray-200 dark:hover:shadow-dark-850">
                <div class="flex items-center justify-center font-semibold text-gray-500 transition duration-200 ease-linear bg-gray-100 rounded-full shrink-0 size-10 dark:bg-dark-850">
                  <lucide-angular name="file-text" class="size-4"></lucide-angular>
                </div>
                <div class="grow">
                  <h6>shopify-docs.txt</h6>
                  <p class="text-sm text-gray-500 dark:text-dark-500">154 kb</p>
                </div>
                <div class="shrink-0">
                  <lucide-angular name="download" class="text-gray-500 dark:text-dark-500 size-5 fill-gray-200 dark:fill-dark-850"></lucide-angular>
                </div>
              </a>
              <a href="javascript: void(0);" class="flex items-center gap-2 p-2 transition duration-300 ease-linear border border-gray-200 border-dashed rounded-md dark:border-dark-800 hover:border-gray-300 dark:hover:border-dark-700 hover:shadow-lg hover:shadow-gray-200 dark:hover:shadow-dark-850">
                <div class="flex items-center justify-center font-semibold transition duration-200 ease-linear bg-gray-100 rounded-full dark:bg-dark-850 shrink-0 size-10">
                  <lucide-angular name="image" class="size-4"></lucide-angular>
                </div>
                <div class="grow">
                  <h6>main-logo.png</h6>
                  <p class="text-sm text-gray-500 dark:text-dark-500">467 kb</p>
                </div>
                <div class="shrink-0">
                  <lucide-angular name="download" class="text-gray-500 size-5 dark:text-dark-500 fill-gray-200 dark:fill-dark-800"></lucide-angular>
                </div>
              </a>
              <a href="javascript: void(0);" class="flex items-center gap-2 p-2 transition duration-300 ease-linear border border-gray-200 border-dashed rounded-md dark:border-dark-800 hover:border-gray-300 dark:hover:border-dark-700 hover:shadow-lg hover:shadow-gray-200 dark:hover:shadow-dark-850">
                <div class="flex items-center justify-center font-semibold text-gray-500 transition duration-200 ease-linear bg-gray-100 rounded-full dark:text-dark-500 dark:bg-dark-850 shrink-0 size-10">
                  <lucide-angular name="file-archive" class="size-5"></lucide-angular>
                </div>
                <div class="grow">
                  <h6>chat.zip</h6>
                  <p class="text-sm text-gray-500 dark:text-dark-500">48 mb</p>
                </div>
                <div class="shrink-0">
                  <lucide-angular name="download" class="text-gray-500 dark:text-dark-500 size-5 fill-gray-200 dark:fill-dark-850"></lucide-angular>
                </div>
              </a>
            </div>
          </ngx-simplebar>
        </div>
      </div>
    </div>
  </div>


  <div id="deleteModal" class="hidden modal show">
    <div class="modal-wrap modal-xs modal-center">
      <div class="text-center modal-content p-7">
        <div class="flex items-center justify-center mx-auto mb-4 text-red-500 rounded-full bg-red-500/10 size-14 backdrop-blur-xl">
          <lucide-angular name="trash2" class="size-6"></lucide-angular>
        </div>
        <h5 class="mb-4">Are you sure you want to delete this msg ?</h5>
        <div class="flex items-center justify-center gap-2">
          <button class="btn btn-red">Delete</button>
          <button data-modal-close="deleteModal" class="btn link link-primary">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>