<app-page-title [Title]="'Customer Database'" [pageTitle]="'POS'"></app-page-title>


<div x-data="employeeTable"
    x-init="showAddress=false; showCity=false; showCountry=false; showRegistrationDate=false; showNotes=false">
    <div class="grid grid-cols-1 sm:grid-cols-2 2xl:grid-cols-4 gap-5">
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-primary-500/15 text-primary-500 rounded-full p-2 shrink-0">
                        <lucide-angular name="users" class="size-5"></lucide-angular>
                    </div>
                    <h6 class="text-gray-500 font-medium dark:text-dark-500 grow">Total Customers</h6>
                    <div class="dropdown shrink-0">
                        <button title="dropdown-button" domixDropdownToggle [dropdownMenu]="dropdown1" type="button"
                            class="flex items-center text-gray-500 dark:text-dark-500">
                            <lucide-angular name="ellipsis" class="size-5"></lucide-angular>
                        </button>
                        <div #dropdown1 class="!fixed p-2 dropdown-menu hidden" dropdown-position="right">
                            <ul>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Weekly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Monthly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Yearly</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <h4 class="mb-3 font-bold">29,710</h4>
                <div class="flex items-center gap-1 text-sm text-green-600">
                    <lucide-angular name="chevron-up" class="size-4"></lucide-angular>
                    +2.3% <span class="text-gray-500 dark:text-dark-500 ltr:ml-1 rtl:mr-1">compared to last month</span>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-yellow-500/15 text-yellow-500 rounded-full p-2 shrink-0">
                        <lucide-angular name="sparkles" class="size-5"></lucide-angular>
                    </div>
                    <h6 class="text-gray-500 font-medium dark:text-dark-500 grow">New Customer</h6>
                    <div class="dropdown shrink-0">
                        <button title="dropdown-button" domixDropdownToggle [dropdownMenu]="dropdown2" type="button"
                            class="flex items-center text-gray-500 dark:text-dark-500">
                            <lucide-angular name="ellipsis" class="size-5"></lucide-angular>
                        </button>
                        <div #dropdown2 class="!fixed p-2 dropdown-menu hidden" dropdown-position="right">
                            <ul>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Weekly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Monthly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Yearly</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <h4 class="mb-3 font-bold">3,361</h4>
                <div class="flex items-center gap-1 text-sm text-red-500">
                    <lucide-angular name="chevron-down" class="size-4"></lucide-angular>
                    -2.3% <span class="text-gray-500 dark:text-dark-500 ltr:ml-1 rtl:mr-1">compared to last month</span>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-green-500/15 text-green-500 rounded-full p-2 shrink-0">
                        <lucide-angular name="repeat-2" class="size-5"></lucide-angular>
                    </div>
                    <h6 class="text-gray-500 font-medium dark:text-dark-500 grow">Return Customer Rate</h6>
                    <div class="dropdown shrink-0">
                        <button title="dropdown-button" domixDropdownToggle [dropdownMenu]="dropdown3" type="button"
                            class="flex items-center text-gray-500 dark:text-dark-500">
                            <lucide-angular name="ellipsis" class="size-5"></lucide-angular>
                        </button>
                        <div #dropdown3 class="!fixed p-2 dropdown-menu hidden" dropdown-position="right">
                            <ul>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Weekly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Monthly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Yearly</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <h4 class="mb-3 font-bold">11.23%</h4>
                <div class="flex items-center gap-1 text-sm text-green-600">
                    <lucide-angular name="chevron-up" class="size-4"></lucide-angular>
                    +1.8% <span class="text-gray-500 dark:text-dark-500 ltr:ml-1 rtl:mr-1">compared to last month</span>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-purple-500/15 text-purple-500 rounded-full p-2 shrink-0">
                        <lucide-angular name="briefcase" class="size-5"></lucide-angular>
                    </div>
                    <h6 class="text-gray-500 font-medium dark:text-dark-500 grow">Avg. Order Revenue</h6>
                    <div class="dropdown shrink-0">
                        <button title="dropdown-button" domixDropdownToggle [dropdownMenu]="dropdown4" type="button"
                            class="flex items-center text-gray-500 dark:text-dark-500">
                            <lucide-angular name="ellipsis" class="size-5"></lucide-angular>
                        </button>
                        <div #dropdown4 class="!fixed p-2 dropdown-menu hidden" dropdown-position="right">
                            <ul>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Weekly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Monthly</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" class="dropdown-item">
                                        <span>Yearly</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <h4 class="mb-3 font-bold">$39,643</h4>
                <div class="flex items-center gap-1 text-sm text-red-500">
                    <lucide-angular name="chevron-down" class="size-4"></lucide-angular>
                    -8% <span class="text-gray-500 dark:text-dark-500 ltr:ml-1 rtl:mr-1">compared to last month</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header flex lg:items-center flex-col lg:flex-row gap-3">
            <h6 class="card-title grow">Customer Database</h6>
            <div class="flex items-center gap-3 shrink-0 flex-wrap">
                <button class="btn btn-sub-gray">Export CSV</button>
                <button class="btn btn-sub-gray">Export Excel</button>
                <div class="dropdown shrink-0">
                    <button title="dropdown-button" type="button" class="flex items-center btn btn-primary">
                        Manage Table Column
                        <svg :class="{ 'transform rotate-180': open }" class="size-5" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="card-body pt-0">
            <div class="overflow-x-auto table-box">
                <table class="table whitespace-nowrap text-sm">
                    <tbody>
                        <tr class="text-gray-500 bg-gray-100 dark:bg-dark-850 dark:text-dark-500">
                            <th *ngFor="let col of columnDefs" class="!font-medium cursor-pointer">
                                <div class="flex items-center gap-space">

                                    <div (click)="onSortChange(col)">
                                        {{col.headerName}} <span *ngIf="col.sortable">
                                            {{ col.sortDiraction === 'asc' ? '↑' : '↓' }}</span>
                                    </div>
                                </div>
                            </th>
                        </tr>

                        <ng-container *ngIf="displayedData.length > 0">
                            <ng-container *ngFor="let employee of displayedData; let i = index">
                                <tr>
                                    <td>
                                        <a href="javascript:void(0);" class="link link-primary">{{employee.CusData}}</a>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-2">
                                            <img [src]="employee.avatar" alt="employee.name"
                                                class="size-8 rounded-full">
                                            <div class="grow">
                                                <h6 class="mb-0 text-sm">
                                                    <a href="javascript:void(0);"
                                                        data-drawer-target="customerDetailsModal"
                                                        class="link link-primary text-current">{{employee.name}}</a>
                                                </h6>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <p class="text-gray-500 dark:text-dark-500">{{employee.email}}</p>
                                    </td>
                                    <td>
                                        <p class="text-gray-500 dark:text-dark-500">{{employee.phone}}</p>
                                    </td>
                                    <td>
                                        <p class="text-gray-500 dark:text-dark-500">{{employee.totalOrders}}
                                        </p>
                                    </td>
                                    <td x-show="showLastOrder">
                                        <p class="text-gray-500 dark:text-dark-500">{{employee.lastOrder}}</p>
                                    </td>
                                    <td>
                                        <p class="text-gray-500 dark:text-dark-500">{{employee.outstanding}}
                                        </p>
                                    </td>
                                    <td>
                                        <span class="badge" [class]="{
                                            'badge-green': employee.status === 'Active',
                                            'badge-red': employee.status === 'Inactive',
                                            'badge-orange': employee.status === 'Overdue',
                                            'badge-yellow': employee.status === 'Pending'
                                        }">{{employee.status}}</span>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button title="dropdown-button" domixDropdownToggle
                                                [dropdownMenu]="dropdown6" type="button"
                                                class="btn btn-sub-sky btn-icon size-8">
                                                <lucide-angular name="more-horizontal" class="size-4"></lucide-angular>
                                            </button>
                                            <div #dropdown6 class="!fixed p-2 dropdown-menu hidden"
                                                dropdown-position="right">
                                                <ul>
                                                    <li><a href="javascript:void(0);" class="dropdown-item"
                                                            data-drawer-target="customerDetailsModal">Overview</a></li>
                                                    <li><a href="javascript:void(0);" class="dropdown-item"
                                                            data-modal-target="deleteModal">Delete</a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </ng-container>
                        </ng-container>

                        <ng-container *ngIf="displayedData.length == 0">
                            <tr>
                                <td colspan="10" class="p-8 text-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto w-12 h-12 text-gray-400"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    <p class="mt-2 text-center text-gray-500">No matching records found</p>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>

            <app-domix-pagination [currentPage]="currentPage" [totalPages]="totalPages" [showingStart]="showingStart"
                [showingEnd]="showingEnd" [totalResults]="displayedData.length" (pageChanged)="onPageChange($event)">
            </app-domix-pagination>
        </div>
    </div>
</div>

<div id="customerDetailsModal" drawer-end class="drawer show">
    <div class="bg-primary-500 text-white text-center py-8 px-6">
        <button data-drawer-close="customerDetailsModal" class="absolute top-4 right-4"><i data-lucide="x"
                class="link text-white/50 hover:text-white size-5"></i></button>
        <div class="w-20 h-20 rounded-full mx-auto mb-4 overflow-hidden border-4 border-white/20">
            <img src="assets/images/avatar/user-18.png" alt="Alex Smith" class="size-full object-cover">
        </div>
        <h4 class="mb-1">William Scott</h4>
        <p class="mb-4 text-white/75">ID: SRBCU31866</p>
        <button type="button" class="btn bg-white text-primary-500 w-full">
            Send offer
        </button>
        <p class="text-white/75 text-sm mt-4">Last activity: Today 08:20 PM</p>
    </div>
    <div class="drawer-content">
        <div class="mb-6">
            <h3 class="text-sm font-medium mb-3">
                Contact Info
            </h3>
            <div class="flex flex-col gap-3">
                <div class="flex items-center text-sm gap-3">
                    <lucide-angular name="mail" class="size-4 text-gray-500"></lucide-angular>
                    <span class="text-primary-500">william.scott&#64;domiex.com</span>
                </div>
                <div class="flex items-center text-sm gap-3">
                    <lucide-angular name="phone" class="size-4 text-gray-500"></lucide-angular>
                    <span>+1 234-567-8914</span>
                </div>
                <div class="flex items-center text-sm gap-3">
                    <lucide-angular name="map-pin" class="size-4 text-gray-500"></lucide-angular>
                    <span>5050 Hill St, Dublin, Ireland</span>
                </div>
            </div>
        </div>
        <div>
            <h3 class="text-sm font-medium mb-3">Other</h3>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-500 dark:text-dark-500">Customer ID</span>
                    <span>SRBCU31866</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 dark:text-dark-500">Total Orders</span>
                    <span>6</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 dark:text-dark-500">Outstanding</span>
                    <span>$120</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 dark:text-dark-500">Last Order</span>
                    <span>Jul 12, 2024</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500 dark:text-dark-500">Status</span>
                    <span class="badge badge-green">Active</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!--delete modal-->
<div id="deleteModal" class="!hidden modal show">
    <div class="modal-wrap modal-xs modal-center">
        <div class="text-center modal-content p-7">
            <div
                class="flex items-center justify-center mx-auto mb-4 text-red-500 rounded-full bg-red-500/10 size-14 backdrop-blur-xl">
                <lucide-angular name="trash-2" class="size-6"></lucide-angular>
            </div>
            <h5 class="mb-4">Are you sure you want to delete this Customer?</h5>
            <div class="flex items-center justify-center gap-2">
                <button class="btn btn-red" data-modal-close="deleteModal">Delete</button>
                <button data-modal-close="deleteModal" class="btn link link-primary">Cancel</button>
            </div>
        </div>
    </div>
</div>